<div class="module coloured colours-maroon usage__graph">
    <h2 class="heading">Usage So Far Today</h2>
    <div class="carousel">
        <div class="carousel__slider">
            <?php
                $c=31;
                while($c)
                {
                    echo '<div class="bar"></div>';
                    $c--;
                }
            ?>
        </div><!-- .carousel__slider -->
        <a href="#" class="car__btn car__btn--right"><span class="icon-arrow-right"></span></a>
        <a href="#" class="car__btn car__btn--left"><span class="icon-arrow-left"></span></a>
    </div><!-- .carousel -->
    <div class="time__label time__label--left">06:23</div><!--
    --><div class="time__label time__label--right"><?php echo date('H:i'); ?></div>
    <div class="usage__total">36L</div>
</div>

<script type="text/javascript">
    
    (function( $ ) {

        $.fn.usageGraph = function( options ) {

            var data = ['80','460','100','230','0','10','300','800','330','410','460','430','800','250','280','450','240','290','480','760','280','350','410','340','420','400','570','380','350','250','300'];
            // console.log(data.length);

            var ratio = Math.max.apply( Math, data ) / 200;
            for (var i = data.length - 1; i >= 0; i--) 
            {
                data[i] = Math.round( data[i] / ratio );
                // data[i] = data[i];
            }

            // console.log(data);
    
            var main = $(this);
            var bars = main.find(".bar");
            var slider = main.find(".carousel__slider");
            var butLeft = main.find(".car__btn--left");
            var butRight = main.find(".car__btn--right");

            bars.each(function(i)
            {
                var x = i;
                var y = 5*i;
                size = 10;  // pick a scaling value
                // var n = PerlinNoise.noise(size*x,size*y,1.49) * 200;
                var n = data[i];
                $(this).css({"margin-top":200-n, 'height':n, 'width':'3%', "margin-right":'0.23%'});
            });

            butLeft.on('click',function(e)
            {
                e.preventDefault();
                var l = slider.position().left;
                slider.animate({'left':l-100});
            });

            butRight.on('click',function(e)
            {
                e.preventDefault();
                slider.animate({'left':0});
            });            

        };

    })( jQuery );

    $(document).on('ready',function()
    {
        $('.usage__graph').usageGraph(null);
    });

</script>